<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Animated DFA Learning Tool</title>
  <style>
    body { font-family: sans-serif; background: #f8fbfe; margin: 0; }
    #app { max-width: 900px; margin: 0 auto; padding: 20px; }
    h1 { text-align: center; margin-bottom: 10px; }
    #gui, #testPanel { display: flex; align-items: center; gap: 10px; justify-content: center; margin-bottom: 10px; }
    #guide { background: #eef7ff; padding: 12px; border-radius: 8px; min-height: 72px; font-size: 15px; margin-bottom: 12px; }
    #dfaSVG { display: block; margin: 0 auto; background: white; border-radius: 8px; border: 1px solid #bcd; }
    #output { min-height: 20px; font-weight: 600; text-align: center; font-size: 16px; }
    .final { stroke: #2ecc71 !important; stroke-width: 4 !important; }
    .initial { stroke-dasharray: 7 5 !important; }
    .active { fill: #ffd54f !important; }
    .arrow { stroke: #4a90e2; stroke-width: 1.1; marker-end: url(#arr); }
.arrow.active { stroke-width: 3 !important; }
    .arrow.active { stroke: #e67e22 !important; }
    .selfloop { stroke:#4a90e2; stroke-width:2.2; fill:none; }
    .selfloopLabel { font-size:12px; fill:#222; }
    .stateLabel { font-size: 16px; font-weight: bold; }
    .transLabel { font-size:13px; fill:#226; }
  </style>
</head>
<body>
  <div id="app">
    <h1>Animated DFA Learning Tool</h1>
    <div id="gui">
      <div>
  <label>DFA Type:&nbsp;
    <select id="dfaType">
      <option value="">Select...</option>
      <option value="startA">Start with 'a'</option>
      <option value="endB">End with 'b'</option>
      <option value="mod30">Length ≡ 0 mod 3</option>
      <option value="mod31">Length ≡ 1 mod 3</option>
      <option value="containsAB">Contains substring "ab"</option>
      <option value="notContainsAA">Not contain "aa"</option>
      <option value="universal">Universal (all accepted)</option>
      <option value="empty">Empty (none accepted)</option>
      <option value="composite">Composite conditions</option>
      <option value="binary">Binary problems</option>
      <option value="word_conditions">Word conditions</option>
      <option value="palindromes">Palindromes</option>
      <option value="counting">Counting letter occurrences</option>
      <option value="forbidden_substrings">Forbidden substrings</option>
      <option value="pattern_repetitions">Pattern repetitions</option>
      <option value="difference_count">Difference count constraints</option>
      <option value="combo">Combined complexity</option>
    </select>
  </label>
</div>

<div>
  <label for="dfaType">Select Type:&nbsp;</label>
<select id="dfaType"></select>
<div id="problemDragPanel" style="margin-bottom:10px;display:flex;gap:12px;"></div>
<div id="problemDropZone" 
     style="display:inline-block;padding:10px 20px;border:2px dashed #aaa;min-width:130px;margin-bottom:4px;">
  <span id="dropText">Drop variation here</span>
</div>
&nbsp;&nbsp;
<div id="problemDragPanel" style="margin-bottom:10px;display:flex;gap:12px;">
  <!-- Problem items will be added here -->
</div>
<div id="problemDropZone" 
     style="display:inline-block;padding:10px 20px;border:2px dashed #aaa;min-width:130px;margin-bottom:4px;">
  <span id="dropText">Drop problem here</span>
</div>
</div>

<div id="guide">Select a DFA type to see construction steps and run animation.</div>
      <div id="constructionControlPanel" style="margin: 10px 0;">
  <button id="prevDesignStepBtn" disabled>Prev Design Step</button>
  <button id="nextDesignStepBtn" disabled>Next Design Step</button>
  <label style="margin-left: 10px;">
    <input type="checkbox" id="autoDesignPlayToggle" checked> Auto Play DFA Design
  </label>
      </div>
    <svg id="dfaSVG" width="780" height="320"></svg>

    <div id="testPanel">
      <label>Test Input:&nbsp;<input id="testStr" maxlength="20" size="16" placeholder="enter string (a,b)" /></label>
      <button id="testBtn">Test & Animate</button>
      <button id="resetBtn">Reset Animation</button>
    </div>
    <div id="output"></div>
  </div>

<script>
// --- DFA Presets ---
  window.onload = function() {
  // put all your JavaScript here, or call init()
  window.onerror = function(msg, url, lineNo, columnNo, error) {
  alert(`JavaScript error: ${msg} at ${lineNo}:${columnNo}`);
  return false;
};
const guide = document.getElementById('guide');
const output = document.getElementById('output');
const testStr = document.getElementById('testStr');
const testBtn = document.getElementById('testBtn');
const resetBtn = document.getElementById('resetBtn');
// rest of your JavaScript code here

const DFAPRESETS = {
startA: [
  {
    description: "Accept strings starting with 'a' - Basic",
    guide: [
      "Step 1: q0 initial.",
      "Step 2: 'a' leads q0 to q1 accepting.",
      "Step 3: All inputs from q1 stay in q1.",
      "Step 4: 'b' leads q0 to q2 trap.",
      "Step 5: Only q1 is accepting."
    ],
    states: [{ id: "q0" }, { id: "q1", accept: true }, { id: "q2" }],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q2", symbol: "b" },
      { from: "q1", to: "q1", symbol: "a" },
      { from: "q1", to: "q1", symbol: "b" },
      { from: "q2", to: "q2", symbol: "a" },
      { from: "q2", to: "q2", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add start state q0.", highlight: { activeState: "q0" } },
      { text: "Add state q1 as accepting.", highlight: { activeState: "q1" } },
      { text: "Add trap state q2.", highlight: { activeState: "q2" } },
      { text: "Add transition from q0 to q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition from q0 to q2 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q2", symbol: "b" } } },
      { text: "Add self-loop transitions on q1 for 'a' and 'b'.", highlight: { transitionArrow: { from: "q1", to: "q1", symbol: "a" } } },
      { text: "Mark q1 as accepting.", highlight: { activeState: "q1" } }
    ]
  },
  {
    description: "Accept strings starting with 'a' then only 'b's",
    guide: [
      "Step 1: q0 start.",
      "Step 2: 'a' leads to q1 accepting.",
      "Step 3: q1 only transitions on 'b' to q2 accepting.",
      "Step 4: q2 loops on 'b' accepting.",
      "Step 5: Other transitions to trap."
    ],
    states: [
      { id: "q0" },
      { id: "q1", accept: true },
      { id: "q2", accept: true },
      { id: "q3" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q3", symbol: "b" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q1", to: "q3", symbol: "a" },
      { from: "q2", to: "q2", symbol: "b" },
      { from: "q2", to: "q3", symbol: "a" },
      { from: "q3", to: "q3", symbol: "a" },
      { from: "q3", to: "q3", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add start state q0.", highlight: { activeState: "q0" } },
      { text: "Add accepting state q1.", highlight: { activeState: "q1" } },
      { text: "Add state q2 accepting with loop on 'b'.", highlight: { activeState: "q2" } },
      { text: "Add trap state q3.", highlight: { activeState: "q3" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q0->q3 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q3", symbol: "b" } } },
      { text: "Add transition q1->q2 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } },
      { text: "Add transition q1->q3 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q3", symbol: "a" } } },
      { text: "Add self-loop on q2 for 'b'.", highlight: { transitionArrow: { from: "q2", to: "q2", symbol: "b" } } },
      { text: "Mark q1 and q2 as accepting.", highlight: { activeState: "q1" } }
    ]
  },
  {
    description: "Accept strings starting with exactly two 'a's",
    guide: [
      "Step 1: q0 initial.",
      "Step 2: 'a' leads to q1.",
      "Step 3: Second 'a' leads to q2 accepting.",
      "Step 4: q2 loops on all inputs.",
      "Step 5: Any other transitions to trap."
    ],
    states: [
      { id: "q0" },
      { id: "q1" },
      { id: "q2", accept: true },
      { id: "q3" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q3", symbol: "b" },
      { from: "q1", to: "q2", symbol: "a" },
      { from: "q1", to: "q3", symbol: "b" },
      { from: "q2", to: "q2", symbol: "a" },
      { from: "q2", to: "q2", symbol: "b" },
      { from: "q3", to: "q3", symbol: "a" },
      { from: "q3", to: "q3", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add start state q0.", highlight: { activeState: "q0" } },
      { text: "Add state q1.", highlight: { activeState: "q1" } },
      { text: "Add accepting state q2.", highlight: { activeState: "q2" } },
      { text: "Add trap state q3.", highlight: { activeState: "q3" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q0->q3 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q3", symbol: "b" } } },
      { text: "Add transition q1->q2 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add transition q1->q3 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q3", symbol: "b" } } },
      { text: "Add self-loop on q2 for 'a' and 'b'.", highlight: { transitionArrow: { from: "q2", to: "q2", symbol: "a" } } },
      { text: "Mark q2 as accepting.", highlight: { activeState: "q2" } }
    ]
  },
  {
    description: "Accept strings starting with 'a' and ending with 'b'",
    guide: [
      "Step 1: q0 initial.",
      "Step 2: 'a' moves to q1.",
      "Step 3: q1 transitions on 'a'/'b' staying in q1.",
      "Step 4: Track if last char was 'b' in q2.",
      "Step 5: q2 accepting if string ends with 'b'."
    ],
    states: [
      { id: "q0" },
      { id: "q1" },
      { id: "q2", accept: true },
      { id: "q3" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q3", symbol: "b" },
      { from: "q1", to: "q1", symbol: "a" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q2", to: "q1", symbol: "a" },
      { from: "q2", to: "q2", symbol: "b" },
      { from: "q3", to: "q3", symbol: "a" },
      { from: "q3", to: "q3", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add start state q0.", highlight: { activeState: "q0" } },
      { text: "Add state q1.", highlight: { activeState: "q1" } },
      { text: "Add accepting state q2.", highlight: { activeState: "q2" } },
      { text: "Add trap state q3.", highlight: { activeState: "q3" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q0->q3 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q3", symbol: "b" } } },
      { text: "Add transition q1->q1 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q1", symbol: "a" } } },
      { text: "Add transition q1->q2 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } },
      { text: "Add transition q2->q1 on 'a'.", highlight: { transitionArrow: { from: "q2", to: "q1", symbol: "a" } } },
      { text: "Add self-loop on q2 for 'b'.", highlight: { transitionArrow: { from: "q2", to: "q2", symbol: "b" } } },
      { text: "Mark q2 as accepting.", highlight: { activeState: "q2" } }
    ]
  },
  {
    description: "Accept strings starting with 'a' and containing at least one 'b'",
    guide: [
      "Step 1: q0 initial.",
      "Step 2: 'a' leads to q1.",
      "Step 3: On 'b' transition to q2 accepting.",
      "Step 4: q2 loops on all inputs.",
      "Step 5: Other transitions to trap."
    ],
    states: [
      { id: "q0" },
      { id: "q1" },
      { id: "q2", accept: true },
      { id: "q3" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q3", symbol: "b" },
      { from: "q1", to: "q1", symbol: "a" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q2", to: "q2", symbol: "a" },
      { from: "q2", to: "q2", symbol: "b" },
      { from: "q3", to: "q3", symbol: "a" },
      { from: "q3", to: "q3", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add start state q0.", highlight: { activeState: "q0" } },
      { text: "Add state q1.", highlight: { activeState: "q1" } },
      { text: "Add accepting state q2.", highlight: { activeState: "q2" } },
      { text: "Add trap state q3.", highlight: { activeState: "q3" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q0->q3 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q3", symbol: "b" } } },
      { text: "Add transition q1->q1 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q1", symbol: "a" } } },
      { text: "Add transition q1->q2 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } },
      { text: "Add self-loop on q2 for 'a' and 'b'.", highlight: { transitionArrow: { from: "q2", to: "q2", symbol: "a" } } },
      { text: "Mark q2 as accepting.", highlight: { activeState: "q2" } }
    ]
  }
],
endB: [
  {
    description: "Accept strings ending with 'b' - Basic",
    guide: [
      "Step 1: q0 initial.",
      "Step 2: On 'b' transition to q1 accepting.",
      "Step 3: On 'a' transition back to q0.",
      "Step 4: q1 loops on 'b'."
    ],
    states: [{ id: "q0" }, { id: "q1", accept: true }],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q0", symbol: "a" },
      { from: "q0", to: "q1", symbol: "b" },
      { from: "q1", to: "q0", symbol: "a" },
      { from: "q1", to: "q1", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add start state q0.", highlight: { activeState: "q0" } },
      { text: "Add accepting state q1.", highlight: { activeState: "q1" } },
      { text: "Add transition from q0 to q0 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q0", symbol: "a" } } },
      { text: "Add transition from q0 to q1 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } },
      { text: "Add transition from q1 to q0 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q0", symbol: "a" } } },
      { text: "Add self-loop on q1 for 'b'.", highlight: { transitionArrow: { from: "q1", to: "q1", symbol: "b" } } }
    ]
  },
  {
    description: "Accept strings ending with exactly two 'b's",
    guide: [
      "Step 1: q0 initial.",
      "Step 2: First 'b' moves to q1.",
      "Step 3: Second 'b' moves to q2 accepting.",
      "Step 4: Other inputs go to trap."
    ],
    states: [
      { id: "q0" },
      { id: "q1" },
      { id: "q2", accept: true },
      { id: "q3" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "b" },
      { from: "q0", to: "q3", symbol: "a" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q1", to: "q3", symbol: "a" },
      { from: "q2", to: "q2", symbol: "a" },
      { from: "q2", to: "q2", symbol: "b" },
      { from: "q3", to: "q3", symbol: "a" },
      { from: "q3", to: "q3", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add start state q0.", highlight: { activeState: "q0" } },
      { text: "Add state q1.", highlight: { activeState: "q1" } },
      { text: "Add accepting state q2.", highlight: { activeState: "q2" } },
      { text: "Add trap state q3.", highlight: { activeState: "q3" } },
      { text: "Add transition q0 to q1 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } },
      { text: "Add transition q0 to q3 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q3", symbol: "a" } } },
      { text: "Add transition q1 to q2 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } },
      { text: "Add transition q1 to q3 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q3", symbol: "a" } } },
      { text: "Add self-loop on q2 for 'a' and 'b'.", highlight: { transitionArrow: { from: "q2", to: "q2", symbol: "a" } } },
      { text: "Mark q2 as accepting.", highlight: { activeState: "q2" } }
    ]
  },
  {
    description: "Accept strings ending with 'b' and containing 'a'",
    guide: [
      "Step 1: q0 initial.",
      "Step 2: Track if 'a' has appeared with q1.",
      "Step3: q2 accepting if ends with 'b' and 'a' seen."
    ],
    states: [
      { id: "q0" },
      { id: "q1" },
      { id: "q2", accept: true },
      { id: "q3" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q3", symbol: "b" },
      { from: "q1", to: "q1", symbol: "a" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q2", to: "q1", symbol: "a" },
      { from: "q2", to: "q2", symbol: "b" },
      { from: "q3", to: "q3", symbol: "a" },
      { from: "q3", to: "q3", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add start state q0.", highlight: { activeState: "q0" } },
      { text: "Add state q1 to track 'a' appeared.", highlight: { activeState: "q1" } },
      { text: "Add accepting state q2.", highlight: { activeState: "q2" } },
      { text: "Add trap state q3.", highlight: { activeState: "q3" } },
      { text: "Add transition q0 to q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q0 to q3 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q3", symbol: "b" } } },
      { text: "Add transition q1 to q1 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q1", symbol: "a" } } },
      { text: "Add transition q1 to q2 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } },
      { text: "Add transition q2 to q1 on 'a'.", highlight: { transitionArrow: { from: "q2", to: "q1", symbol: "a" } } },
      { text: "Add self-loop on q2 for 'b'.", highlight: { transitionArrow: { from: "q2", to: "q2", symbol: "b" } } },
      { text: "Mark q2 as accepting.", highlight: { activeState: "q2" } }
    ]
  },
  {
    description: "Accept strings ending with 'b' and having odd length",
    guide: [
      "Step 1: q0 even length, q1 odd length.",
      "Step 2: q2 indicates ends with 'b' and odd length accepting.",
      "Step 3: transitions update length parity and last char."
    ],
    states: [
      { id: "q0" },
      { id: "q1" },
      { id: "q2", accept: true },
      { id: "q3" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q2", symbol: "b" },
      { from: "q1", to: "q0", symbol: "a" },
      { from: "q1", to: "q3", symbol: "b" },
      { from: "q2", to: "q3", symbol: "a" },
      { from: "q2", to: "q0", symbol: "b" },
      { from: "q3", to: "q2", symbol: "a" },
      { from: "q3", to: "q1", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add state q0 for even length.", highlight: { activeState: "q0" } },
      { text: "Add state q1 for odd length.", highlight: { activeState: "q1" } },
      { text: "Add state q2 for even length ending with 'b' (accepting).", highlight: { activeState: "q2" } },
      { text: "Add state q3 for odd length ending with 'b' (accepting).", highlight: { activeState: "q3" } },
      { text: "Add transition q0 to q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q0 to q2 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q2", symbol: "b" } } },
      { text: "Add transition q1 to q0 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q0", symbol: "a" } } },
      { text: "Add transition q1 to q3 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q3", symbol: "b" } } },
      { text: "Add transition q2 to q3 on 'a'.", highlight: { transitionArrow: { from: "q2", to: "q3", symbol: "a" } } },
      { text: "Add transition q2 to q0 on 'b'.", highlight: { transitionArrow: { from: "q2", to: "q0", symbol: "b" } } },
      { text: "Add transition q3 to q2 on 'a'.", highlight: { transitionArrow: { from: "q3", to: "q2", symbol: "a" } } },
      { text: "Add transition q3 to q1 on 'b'.", highlight: { transitionArrow: { from: "q3", to: "q1", symbol: "b" } } }
    ]
  },
  {
    description: "Accept strings ending with 'b' containing substring 'ab'",
    guide: [
      "Step 1: q0 start, q1 after seeing 'a', q2 after 'ab' accepting.",
      "Step 2: q3 trap state.",
      "Step 3: Accept if ends with 'b' and contains 'ab'."
    ],
    states: [
      { id: "q0" },
      { id: "q1" },
      { id: "q2", accept: true },
      { id: "q3" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q0", symbol: "b" },
      { from: "q1", to: "q1", symbol: "a" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q2", to: "q2", symbol: "a" },
      { from: "q2", to: "q2", symbol: "b" },
      { from: "q3", to: "q3", symbol: "a" },
      { from: "q3", to: "q3", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add start state q0.", highlight: { activeState: "q0" } },
      { text: "Add state q1 to track 'a' seen.", highlight: { activeState: "q1" } },
      { text: "Add accepting state q2 after 'ab' seen.", highlight: { activeState: "q2" } },
      { text: "Add trap state q3.", highlight: { activeState: "q3" } },
      { text: "Add transition q0 to q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add self-loop on q0 for 'b'.", highlight: { transitionArrow: { from: "q0", to: "q0", symbol: "b" } } },
      { text: "Add transition q1 to q1 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q1", symbol: "a" } } },
      { text: "Add transition q1 to q2 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } },
      { text: "Add self-loops on q2 for 'a' and 'b'.", highlight: { transitionArrow: { from: "q2", to: "q2", symbol: "a" } } },
      { text: "Mark q2 as accepting.", highlight: { activeState: "q2" } }
    ]
  }
],
mod30: [
  {
    description: "Strings length divisible by 3",
    guide: [
      "States track length mod 3.",
      "Start and accept is q0.",
      "Cycle q0 -> q1 -> q2 -> q0 with every input."
    ],
    states: [
      { id: "q0", accept: true },
      { id: "q1" },
      { id: "q2" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q1", symbol: "b" },
      { from: "q1", to: "q2", symbol: "a" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q2", to: "q0", symbol: "a" },
      { from: "q2", to: "q0", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add start and accepting state q0.", highlight: { activeState: "q0" } },
      { text: "Add state q1.", highlight: { activeState: "q1" } },
      { text: "Add state q2.", highlight: { activeState: "q2" } },
      { text: "Add transition q0->q1 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q1->q2 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add transition q2->q0 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q2", to: "q0", symbol: "a" } } }
    ]
  },
  {
    description: "Strings length mod 3 equals 1",
    guide: [
      "Accept state is q1.",
      "Similar cycling as divisible by 3, but q1 is accept."
    ],
    states: [
      { id: "q0" },
      { id: "q1", accept: true },
      { id: "q2" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q1", symbol: "b" },
      { from: "q1", to: "q2", symbol: "a" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q2", to: "q0", symbol: "a" },
      { from: "q2", to: "q0", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add states q0, q1 (accepting), q2.", highlight: { activeState: "q1" } },
      { text: "Add transition q0->q1 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q1->q2 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add transition q2->q0 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q2", to: "q0", symbol: "a" } } }
    ]
  },
  {
    description: "Strings length mod 3 equals 2",
    guide: [
      "Accept state is q2.",
      "Cycle similarly to mod3."
    ],
    states: [
      { id: "q0" },
      { id: "q1" },
      { id: "q2", accept: true }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q1", symbol: "b" },
      { from: "q1", to: "q2", symbol: "a" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q2", to: "q0", symbol: "a" },
      { from: "q2", to: "q0", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add states q0, q1, q2 (accepting).", highlight: { activeState: "q2" } },
      { text: "Add transition q0->q1 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q1->q2 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add transition q2->q0 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q2", to: "q0", symbol: "a" } } }
    ]
  },
  {
    description: "Strings length divisible by 6",
    guide: [
      "Combine two cycles of mod3 to get divisible by 6.",
      "Accept state only when length mod 6 is 0."
    ],
    states: [
      { id: "q0", accept: true },
      { id: "q1" },
      { id: "q2" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q1", symbol: "b" },
      { from: "q1", to: "q2", symbol: "a" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q2", to: "q0", symbol: "a" },
      { from: "q2", to: "q0", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add states q0 (accepting), q1, q2.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q1->q2 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add transition q2->q0 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q2", to: "q0", symbol: "a" } } }
    ]
  },
  {
    description: "Strings length > 0 and divisible by 3",
    guide: [
      "All strings of length mod 3=0 and length>0.",
      "Reject empty string.",
      "Accept q0 only if length > 0 reached."
    ],
    states: [
      { id: "q0" },
      { id: "q1" },
      { id: "q2", accept: true }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q1", symbol: "b" },
      { from: "q1", to: "q2", symbol: "a" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q2", to: "q0", symbol: "a" },
      { from: "q2", to: "q0", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add states q0, q1, q2 (accepting).", highlight: { activeState: "q2" } },
      { text: "Add transition q0->q1 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q1->q2 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add transition q2->q0 on 'a' and 'b'.", highlight: { transitionArrow: { from: "q2", to: "q0", symbol: "a" } } }
    ]
  }
],
  combo: [
  {
    description: "Accept strings starting ‘a’, ending ‘b’, length mod 3=0",
    guide: [
      "Step 1: Track start with 'a' in first states.",
      "Step 2: Track length mod 3 separately.",
      "Step 3: Track ending with 'b' in last states.",
      "Step 4: Accept only if all conditions true."
    ],
    states: [
      { id: "q0" }, { id: "q1" }, { id: "q2" },
      { id: "q3" }, { id: "q4" }, { id: "q5", accept: true },
      { id: "q6" }, { id: "q7" }, { id: "q8" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q6", symbol: "b" },
      { from: "q1", to: "q2", symbol: "a" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q6", to: "q7", symbol: "a" },
      { from: "q6", to: "q7", symbol: "b" },
      { from: "q2", to: "q0", symbol: "a" },
      { from: "q2", to: "q0", symbol: "b" },
      { from: "q7", to: "q8", symbol: "a" },
      { from: "q7", to: "q8", symbol: "b" },
      { from: "q0", to: "q3", symbol: "b" },
      { from: "q1", to: "q4", symbol: "b" },
      { from: "q2", to: "q5", symbol: "b" },
      { from: "q3", to: "q3", symbol: "a" },
      { from: "q3", to: "q3", symbol: "b" },
      { from: "q4", to: "q4", symbol: "a" },
      { from: "q4", to: "q4", symbol: "b" },
      { from: "q5", to: "q5", symbol: "a" },
      { from: "q5", to: "q5", symbol: "b" },
      { from: "q6", to: "q3", symbol: "b" },
      { from: "q7", to: "q4", symbol: "b" },
      { from: "q8", to: "q5", symbol: "b" },
      { from: "q8", to: "q8", symbol: "a" }
    ],
    constructionSteps: [
      { text: "Add states q0 to q8, mark q5 as accepting.", highlight: { activeState: "q0" } },
      { text: "Add start transitions on 'a' and 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add length mod 3 transitions between q1, q2, q0 and q6, q7, q8.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add transitions tracking last character 'b' states q3, q4, q5.", highlight: { transitionArrow: { from: "q0", to: "q3", symbol: "b" } } },
      { text: "Add self-loops on q3, q4, q5 for both symbols.", highlight: { activeState: "q3" } }
    ]
  },
  {
    description: "Strings start with 'b', contain 'a', length mod 3=1",
    guide: [
      "Step 1: Track 'start with b'.",
      "Step 2: Track if 'a' seen with separate states.",
      "Step 3: Track length mod 3.",
      "Step 4: Accept if all true and length mod 3=1."
    ],
    states: [
      { id: "q0" }, { id: "q1" }, { id: "q2" }, { id: "q3" },
      { id: "q4" }, { id: "q5", accept: true }, { id: "q6" }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "b" },
      { from: "q0", to: "q6", symbol: "a" },
      { from: "q1", to: "q2", symbol: "a" },
      { from: "q1", to: "q3", symbol: "b" },
      { from: "q2", to: "q2", symbol: "a" },
      { from: "q2", to: "q4", symbol: "b" },
      { from: "q3", to: "q3", symbol: "a" },
      { from: "q3", to: "q5", symbol: "b" },
      { from: "q4", to: "q4", symbol: "a" },
      { from: "q4", to: "q5", symbol: "b" },
      { from: "q5", to: "q5", symbol: "a" },
      { from: "q5", to: "q5", symbol: "b" },
      { from: "q6", to: "q6", symbol: "a" },
      { from: "q6", to: "q6", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add states q0 to q6.", highlight: { activeState: "q0" } },
      { text: "Add start transitions.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } },
      { text: "Add transitions tracking 'a' seen in separate states.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add length mod 3 tracking and accept state q5.", highlight: { activeState: "q5" } }
    ]
  },
  {
    description: "Strings contain substring 'ab' and length mod 3=2",
    guide: [
      "Track substring 'ab' occurrence.",
      "Track length mod 3.",
      "Accept only when both conditions met."
    ],
    states: [
      { id: "q0" }, { id: "q1" }, { id: "q2" },
      { id: "q3" }, { id: "q4", accept: true }, { id: "q5" }
    ],
    initial: "q0",
    alpha: ["a","b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q0", symbol: "b" },
      { from: "q1", to: "q1", symbol: "a" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q2", to: "q3", symbol: "a" },
      { from: "q2", to: "q2", symbol: "b" },
      { from: "q3", to: "q4", symbol: "b" },
      { from: "q3", to: "q5", symbol: "a" },
      { from: "q4", to: "q4", symbol: "a" },
      { from: "q4", to: "q4", symbol: "b" },
      { from: "q5", to: "q5", symbol: "a" },
      { from: "q5", to: "q5", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add states for substring and length tracking.", highlight: { activeState: "q0" } },
      { text: "Add transitions for 'a' and 'b' from q0.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add substring detection transitions.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } },
      { text: "Add length mod 3 transitions.", highlight: { transitionArrow: { from: "q2", to: "q3", symbol: "a" } } },
      { text: "Add accepting state q4.", highlight: { activeState: "q4" } }
    ]
  },
  {
    description: "Strings start with 'ab' and end with 'ba'",
    guide: [
      "Step 1: Track start equals 'ab'.",
      "Step 2: Track last two characters end with 'ba'.",
      "Step 3: Accept only if both true."
    ],
    states: [
      { id: "q0" }, { id: "q1" }, { id: "q2" },
      { id: "q3" }, { id: "q4" }, { id: "q5", accept: true }
    ],
    initial: "q0",
    alpha: ["a", "b"],
    transitions: [
      { from: "q0", to: "q1", symbol: "a" },
      { from: "q0", to: "q3", symbol: "b" },
      { from: "q1", to: "q2", symbol: "b" },
      { from: "q1", to: "q3", symbol: "a" },
      { from: "q2", to: "q5", symbol: "a" },
      { from: "q2", to: "q4", symbol: "b" },
      { from: "q3", to: "q3", symbol: "a" },
      { from: "q3", to: "q3", symbol: "b" },
      { from: "q4", to: "q5", symbol: "a" },
      { from: "q4", to: "q4", symbol: "b" },
      { from: "q5", to: "q5", symbol: "a" },
      { from: "q5", to: "q5", symbol: "b" }
    ],
    constructionSteps: [
      { text: "Add states tracking start 'ab' and end 'ba'.", highlight: { activeState: "q0" } },
      { text: "Add transitions reflecting start 'ab' detection.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transitions reflecting end 'ba' tracking.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } },
      { text: "Add accepting state q5.", highlight: { activeState: "q5" } }
    ]
  }
],
composite: [
  {
    description: "Strings start with 'a', contain 'bb' and end with 'b'",
    guide: [
      "Step 1: Track start 'a'.",
      "Step 2: Track substring 'bb'.",
      "Step 3: Track if string ends with 'b'.",
      "Step 4: Accept if all true."
    ],
    states: [
      { id: "q0" },{ id: "q1" },{ id: "q2" },{ id: "q3" },{ id: "q4" },{ id: "q5", accept:true },
      { id: "q6" },{ id: "q7" },{ id: "q8" }
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      { from:"q0", to:"q1", symbol:"a" },
      { from:"q0", to:"q6", symbol:"b" },
      { from:"q1", to:"q2", symbol:"b" },
      { from:"q1", to:"q1", symbol:"a" },
      { from:"q2", to:"q3", symbol:"b" },
      { from:"q2", to:"q1", symbol:"a" },
      { from:"q3", to:"q3", symbol:"b" },
      { from:"q3", to:"q5", symbol:"b" },
      { from:"q4", to:"q4", symbol:"a" },
      { from:"q4", to:"q4", symbol:"b" },
      { from:"q5", to:"q5", symbol:"a" },
      { from:"q5", to:"q5", symbol:"b" },
      { from:"q6", to:"q6", symbol:"a" },
      { from:"q6", to:"q6", symbol:"b" },
      { from:"q7", to:"q7", symbol:"a" },
      { from:"q7", to:"q7", symbol:"b" },
      { from:"q8", to:"q8", symbol:"a" },
      { from:"q8", to:"q8", symbol:"b" }
    ],
    constructionSteps: [
      { text: "Add states q0 to q8; start at q0.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q0->q6 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q6", symbol: "b" } } },
      { text: "Add substring 'bb' detection states and transitions.", highlight: { activeState: "q1" } },
      { text: "Add ending 'b' tracking states q3, q4, q5.", highlight: { activeState: "q3" } },
      { text: "Mark q5 as accepting.", highlight: { activeState: "q5" } }
    ]
  },
  {
    description: "Strings start with 'b', end with 'a', contain 'aba'",
    guide:[
      "Step 1: Check start with 'b'.",
      "Step 2: Check substring 'aba'.",
      "Step 3: Check ends with 'a'.",
      "Step 4: Accept if all true."
    ],
    states: [
      {id:"q0"},{id:"q1"},{id:"q2"},{id:"q3"},{id:"q4"},{id:"q5",accept:true}
    ],
    initial: "q0",
    alpha: ["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q0",to:"q3",symbol:"a"},
      {from:"q1",to:"q1",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q2",to:"q3",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q3",to:"q4",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"},
      {from:"q4",to:"q4",symbol:"a"},
      {from:"q4",to:"q5",symbol:"a"},
      {from:"q5",to:"q5",symbol:"a"},
      {from:"q5",to:"q5",symbol:"b"}
    ],
    constructionSteps: [
      { text: "Add states q0 to q5; start at q0.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } },
      { text: "Add transition q0->q3 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q3", symbol: "a" } } },
      { text: "Add substring 'aba' detection transitions.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add end with 'a' detection transitions.", highlight: { transitionArrow: { from: "q3", to: "q4", symbol: "a" } } },
      { text: "Mark q5 as accepting.", highlight: { activeState: "q5" } }
    ]
  },
  {
    description: "Strings that start and end with same letter",
    guide:[
      "Step 1: Track first letter.",
      "Step 2: Track last letter.",
      "Step 3: Accept if equal."
    ],
    states:[
      {id:"q0"},{id:"q1a"},{id:"q1b"},{id:"q2a",accept:true},{id:"q2b",accept:true},{id:"q3"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1a",symbol:"a"},
      {from:"q0",to:"q1b",symbol:"b"},
      {from:"q1a",to:"q2a",symbol:"a"},
      {from:"q1a",to:"q3",symbol:"b"},
      {from:"q1b",to:"q3",symbol:"a"},
      {from:"q1b",to:"q2b",symbol:"b"},
      {from:"q2a",to:"q2a",symbol:"a"},
      {from:"q2a",to:"q3",symbol:"b"},
      {from:"q2b",to:"q3",symbol:"a"},
      {from:"q2b",to:"q2b",symbol:"b"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"}
    ],
    constructionSteps: [
      { text: "Add states q0 to q3 tracking first and last letter.", highlight: { activeState: "q0" } },
      { text: "Add transitions to track starting letter.", highlight: { transitionArrow: { from: "q0", to: "q1a", symbol: "a" } } },
      { text: "Add transitions to track last letter.", highlight: { transitionArrow: { from: "q0", to: "q1b", symbol: "b" } } },
      { text: "Mark q2a and q2b as accepting.", highlight: { activeState: "q2a" } }
    ]
  },
  {
    description: "Strings that contain substring 'aba'",
    guide:[
      "Step 1: Track substring 'aba' occurrence.",
      "Step 2: Move through states recognizing substring.",
      "Step 3: Accept once substring seen."
    ],
    states:[
      {id:"q0"},{id:"q1"},{id:"q2"},{id:"q3",accept:true},{id:"q4"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q1",to:"q4",symbol:"a"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q2",to:"q1",symbol:"a"},
      {from:"q2",to:"q0",symbol:"b"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"},
      {from:"q4",to:"q1",symbol:"a"},
      {from:"q4",to:"q2",symbol:"b"}
    ],
    constructionSteps: [
      { text: "Add states q0 to q4.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transitions tracking substring 'aba'.", highlight: { transitionArrow: { from: "q1", to: "q4", symbol: "a" } } },
      { text: "Add transitions transitioning between substring states.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } },
      { text: "Mark q3 as accepting.", highlight: { activeState: "q3" } }
    ]
  },
  {
    description: "Strings that don't contain substring 'aa'",
    guide:[
      "Step 1: Track last character to prevent 'aa'.",
      "Step 2: Accept if no two consecutive 'a's."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1",accept:true},{id:"q2"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q0",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"}
    ],
    constructionSteps: [
      { text: "Add states q0, q1, q2.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Prevent 'aa' by moving q1->q2 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add appropriate loops for 'b'.", highlight: { transitionArrow: { from: "q0", to: "q0", symbol: "b" } } },
      { text: "Mark q0 and q1 as accepting.", highlight: { activeState: "q0" } }
    ]
  }
],
binary: [
  {
    description: "Strings with at least 2 'a's",
    guide:[
      "Step 1: Count 'a's up to 2.",
      "Step 2: Accept if count >= 2."
    ],
    states:[
      {id:"q0"},{id:"q1"},{id:"q2",accept:true}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q1",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add start state q0.", highlight: { activeState: "q0" } },
      { text: "Add state q1.", highlight: { activeState: "q1" } },
      { text: "Add accepting state q2.", highlight: { activeState: "q2" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add self-loop on q0 for 'b'.", highlight: { transitionArrow: { from: "q0", to: "q0", symbol: "b" } } },
      { text: "Add transition q1->q2 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } }
    ]
  },
  {
    description: "Strings with at most 2 'b's",
    guide:[
      "Step 1: Count 'b's up to 2.",
      "Step 2: Reject if more than 2."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1",accept:true},{id:"q2",accept:true},{id:"q3"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q0",symbol:"a"},
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q1",to:"q1",symbol:"a"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q3",symbol:"b"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q3; q0-q2 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q0 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q0", symbol: "a" } } },
      { text: "Add transition q0->q1 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } },
      { text: "Add transition q1->q2 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } },
      { text: "Add transition q2->q3 on 'b'.", highlight: { transitionArrow: { from: "q2", to: "q3", symbol: "b" } } }
    ]
  },
  {
    description: "Strings with exactly 2 'a's",
    guide:[
      "Step 1: Count 'a's exactly 2.",
      "Step 2: Reject if less or more."
    ],
    states:[
      {id:"q0"},{id:"q1"},{id:"q2",accept:true},{id:"q3"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q1",symbol:"b"},
      {from:"q2",to:"q3",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q3.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q1->q2 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add transition q1->q1 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q1", symbol: "b" } } },
      { text: "Mark q2 as accepting.", highlight: { activeState: "q2" } }
    ]
  },
  {
    description: "Strings with at least 2 'b's and contain substring 'ab'",
    guide:[
      "Step 1: Count 'b's at least 2.",
      "Step 2: Track substring 'ab'.",
      "Step 3: Accept if both true."
    ],
    states:[
      {id:"q0"},{id:"q1"},{id:"q2"},{id:"q3"},{id:"q4",accept:true}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q0",symbol:"a"},
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q1",to:"q3",symbol:"a"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"},
      {from:"q3",to:"q4",symbol:"b"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q4",to:"q4",symbol:"a"},
      {from:"q4",to:"q4",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q4.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } },
      { text: "Add substring 'ab' tracking transitions.", highlight: { transitionArrow: { from: "q1", to: "q3", symbol: "a" } } },
      { text: "Add transitions for count and substring.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } },
      { text: "Mark q4 as accepting.", highlight: { activeState: "q4" } }
    ]
  },
  {
    description: "Strings with at most 2 'a's and not containing substring 'bb'",
    guide:[
      "Step 1: Count 'a's up to 2.",
      "Step 2: Reject strings containing 'bb'.",
      "Step 3: Accept if both true."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1",accept:true},{id:"q2",accept:true},{id:"q3"},{id:"q4"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q0",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q0",symbol:"b"},
      {from:"q0",to:"q3",symbol:"b"},
      {from:"q3",to:"q4",symbol:"b"},
      {from:"q4",to:"q4",symbol:"a"},
      {from:"q4",to:"q4",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q4.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transitions preventing substring 'bb'.", highlight: { transitionArrow: { from: "q0", to: "q0", symbol: "b" } } },
      { text: "Add transitions to count 'a's.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Mark q0, q1, q2 as accepting.", highlight: { activeState: "q0" } }
    ]
  }
],
  word_conditions: [
  {
    description: "Strings with exactly two 'a's and at least one 'b'",
    guide:[
      "Step 1: Count exactly two 'a's.",
      "Step 2: Check at least one 'b'.",
      "Step 3: Accept only when both satisfied."
    ],
    states:[
      {id:"q0"},{id:"q1"},{id:"q2"},{id:"q3"},{id:"q4",accept:true}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q3",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q4",symbol:"b"},
      {from:"q2",to:"q3",symbol:"a"},
      {from:"q2",to:"q4",symbol:"b"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"},
      {from:"q4",to:"q4",symbol:"a"},
      {from:"q4",to:"q4",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q4.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q0->q3 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q3", symbol: "b" } } },
      { text: "Add transition q1->q2 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add transition q1->q4 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q4", symbol: "b" } } },
      { text: "Mark q4 as accepting.", highlight: { activeState: "q4" } }
    ]
  },
  {
    description: "Strings with at most two 'b's and no substring 'aa'",
    guide:[
      "Step 1: Count at most two 'b's.",
      "Step 2: Reject substring 'aa'.",
      "Step 3: Accept if both true."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1",accept:true},{id:"q2",accept:true},{id:"q3"},{id:"q4"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q1",to:"q3",symbol:"a"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q2",to:"q2",symbol:"b"},
      {from:"q2",to:"q4",symbol:"a"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"},
      {from:"q4",to:"q4",symbol:"a"},
      {from:"q4",to:"q4",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q4.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transitions to prevent substring 'aa'.", highlight: { transitionArrow: { from: "q1", to: "q3", symbol: "a" } } },
      { text: "Mark q0, q1, q2 as accepting.", highlight: { activeState: "q0" } }
    ]
  },
  {
    description: "Strings with exactly one 'a' or exactly one 'b'",
    guide:[
      "Step 1: Count exactly one 'a' or exactly one 'b'.",
      "Step 2: Accept strings satisfying either."
    ],
    states:[
      {id:"q0"},{id:"q1a"},{id:"q1b"},{id:"q2a"},{id:"q2b",accept:true}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1a",symbol:"a"},
      {from:"q0",to:"q1b",symbol:"b"},
      {from:"q1a",to:"q2a",symbol:"a"},
      {from:"q1a",to:"q1a",symbol:"b"},
      {from:"q1b",to:"q1b",symbol:"a"},
      {from:"q1b",to:"q2b",symbol:"b"},
      {from:"q2a",to:"q2a",symbol:"a"},
      {from:"q2a",to:"q2a",symbol:"b"},
      {from:"q2b",to:"q2b",symbol:"a"},
      {from:"q2b",to:"q2b",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add all states q0 to q2b.", highlight: { activeState: "q0" } },
      { text: "Add transitions starting with 'a' and 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1a", symbol: "a" } } },
      { text: "Add transitions for counting occurrences.", highlight: { transitionArrow: { from: "q1a", to: "q2a", symbol: "a" } } },
      { text: "Mark accepting states q2a and q2b.", highlight: { activeState: "q2a" } }
    ]
  },
  {
    description: "Strings with at least 3 total 'a' and 'b'",
    guide:[
      "Step 1: Count total 'a' and 'b' occurrences.",
      "Step 2: Accept if total >= 3."
    ],
    states:[
      {id:"q0"},{id:"q1"},{id:"q2"},{id:"q3",accept:true}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q2",to:"q3",symbol:"a"},
      {from:"q2",to:"q3",symbol:"b"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q3.", highlight: { activeState: "q0" } },
      { text: "Add transitions for counting total occurrences.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add accepting state q3.", highlight: { activeState: "q3" } }
    ]
  },
  {
    description: "Strings with word length exactly 4",
    guide:[
      "Step 1: Count characters up to 4.",
      "Step 2: Accept if length exactly 4."
    ],
    states:[
      {id:"q0"},{id:"q1"},{id:"q2"},{id:"q3"},{id:"q4",accept:true},{id:"q5"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q2",to:"q3",symbol:"a"},
      {from:"q2",to:"q3",symbol:"b"},
      {from:"q3",to:"q4",symbol:"a"},
      {from:"q3",to:"q4",symbol:"b"},
      {from:"q4",to:"q5",symbol:"a"},
      {from:"q4",to:"q5",symbol:"b"},
      {from:"q5",to:"q5",symbol:"a"},
      {from:"q5",to:"q5",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q5.", highlight: { activeState: "q0" } },
      { text: "Add transitions counting characters up to 4.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Mark accepting state q4.", highlight: { activeState: "q4" } }
    ]
  }
],
palindromes: [
  {
    description: "Even length palindrome over {a,b} with length 2",
    guide:[
      "Step 1: Accept only 'aa' or 'bb'.",
      "Step 2: q0 start; move to q1 on 'a', to q2 on 'b'.",
      "Step 3: q1 accept if next char 'a', q2 accept if next char 'b'."
    ],
    states:[
      {id:"q0"},{id:"q1"},{id:"q2"},{id:"q3",accept:true}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q2",symbol:"b"},
      {from:"q1",to:"q3",symbol:"a"},
      {from:"q1",to:"q3",symbol:"b"},
      {from:"q2",to:"q3",symbol:"a"},
      {from:"q2",to:"q3",symbol:"b"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q3.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q0->q2 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q2", symbol: "b" } } },
      { text: "Add transitions q1->q3 and q2->q3 on 'a'/'b'.", highlight: { transitionArrow: { from: "q1", to: "q3", symbol: "a" } } },
      { text: "Mark q3 as accepting.", highlight: { activeState: "q3" } }
    ]
  },
  {
    description: "Odd length palindrome over {a,b}: length 3",
    guide:[
      "Track center symmetry for length 3.",
      "Accept strings like 'aba' and 'bab'."
    ],
    states:[
      {id:"q0"},{id:"q1"},{id:"q2",accept:true},{id:"q3"},{id:"q4"},{id:"q5"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q4",symbol:"b"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q1",to:"q3",symbol:"a"},
      {from:"q4",to:"q5",symbol:"a"},
      {from:"q4",to:"q2",symbol:"b"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"},
      {from:"q5",to:"q5",symbol:"a"},
      {from:"q5",to:"q5",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q5.", highlight: { activeState: "q0" } },
      { text: "Add transitions for 'a' start q0->q1 and 'b' start q0->q4.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transitions for center symmetry and acceptance.", highlight: { activeState: "q2" } }
    ]
  },
  {
    description: "Strings palindromic of length ≤4 even",
    guide:[
      "Track strings with length 2 or 4 and palindrome."
    ],
    states:[
      // Complex DFA states omitted for brevity here
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      // Transitions omitted for brevity
    ],
    constructionSteps:[
      { text: "Complex construction steps, states and transitions omitted here.", highlight: {} }
    ]
  },
  {
    description: "Length 3 or 5 odd palindrome",
    guide:[
      "Track palindrome of length 3 or 5."
    ],
    states:[
      // Complex DFA states omitted
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      // Omitted transitions
    ],
    constructionSteps:[
      { text: "Complex construction steps for length 3 or 5 palindrome, omitted.", highlight: {} }
    ]
  },
  {
    description: "Palindrome with all letters 'a'",
    guide:[
      "Strings of repeated 'a's and are palindromes."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q0",to:"q2",symbol:"b"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q2",to:"q2",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q2.", highlight: { activeState: "q0" } },
      { text: "Add transitions for repeated 'a's.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Mark q0 as accepting.", highlight: { activeState: "q0" } }
    ]
  }
],
counting: [
  {
    description: "Count 'a's divisible by 2",
    guide:[
      "States track parity of count of 'a's.",
      "Accept only if count mod 2 == 0."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q1",to:"q0",symbol:"a"},
      {from:"q1",to:"q1",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add start and accepting state q0.", highlight: { activeState: "q0" } },
      { text: "Add state q1 for odd count.", highlight: { activeState: "q1" } },
      { text: "Add transitions q0->q1 on 'a' and q1->q0 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add self-loops on both states for 'b'.", highlight: { transitionArrow: { from: "q0", to: "q0", symbol: "b" } } }
    ]
  },
  {
    description: "Count 'b's divisible by 3",
    guide:[
      "States track count mod 3 of 'b's.",
      "Accept if count mod3 == 0."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q0",symbol:"a"},
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q1",to:"q0",symbol:"a"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q0",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 (accept), q1, q2.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } },
      { text: "Add transition q1->q2 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } },
      { text: "Add transition q2->q0 on 'b'.", highlight: { transitionArrow: { from: "q2", to: "q0", symbol: "b" } } }
    ]
  },
  {
    description: "Count 'a's not divisible by 2",
    guide:[
      "Accept if count mod 2 == 1."
    ],
    states:[
      {id:"q0"},{id:"q1",accept:true}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q1",to:"q0",symbol:"a"},
      {from:"q1",to:"q1",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 and q1 (accept).", highlight: { activeState: "q1" } },
      { text: "Add transitions q0->q1 on 'a' and q1->q0 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add self-loops for 'b'.", highlight: { transitionArrow: { from: "q0", to: "q0", symbol: "b" } } }
    ]
  },
  {
    description: "Count 'b's equals count 'a's mod 2",
    guide:[
      "Track counts mod 2 of 'a' and 'b' and accept if equal."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"},{id:"q3"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q2",symbol:"b"},
      {from:"q1",to:"q0",symbol:"a"},
      {from:"q1",to:"q3",symbol:"b"},
      {from:"q2",to:"q3",symbol:"a"},
      {from:"q2",to:"q0",symbol:"b"},
      {from:"q3",to:"q2",symbol:"a"},
      {from:"q3",to:"q1",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q3; q0 accept.", highlight: { activeState: "q0" } },
      { text: "Add transitions tracking 'a' and 'b' counts mod 2.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } }
    ]
  },
  {
    description: "Count difference of 'a' and 'b' <= 1",
    guide:[
      "Track difference in counts staying in range 0 or 1."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q0",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q1",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q2; q0 accept.", highlight: { activeState: "q0" } },
      { text: "Add transitions tracking difference of counts.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } }
    ]
  }
],
difference_count: [
  {
    description: "Strings with number of 'a's ≥ number of 'b's",
    guide:[
      "Track difference of counts.",
      "Accept if difference ≥ 0."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q0",symbol:"a"},
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q1",to:"q0",symbol:"a"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q2; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transitions to track difference ≥ 0.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } }
    ]
  },
  {
    description: "Strings with number of 'a's ≤ number of 'b's",
    guide:[
      "Track difference of counts.",
      "Accept if difference ≤ 0."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q1",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q2; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transitions to track difference ≤ 0.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } }
    ]
  },
  {
    description: "Strings with equal number of 'a's and 'b's",
    guide:[
      "Track difference of counts.",
      "Accept if difference = 0."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"},{id:"q3"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q2",symbol:"b"},
      {from:"q1",to:"q0",symbol:"a"},
      {from:"q1",to:"q3",symbol:"b"},
      {from:"q2",to:"q3",symbol:"a"},
      {from:"q2",to:"q0",symbol:"b"},
      {from:"q3",to:"q2",symbol:"a"},
      {from:"q3",to:"q1",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q3; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transitions for difference = 0 tracking.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } }
    ]
  },
  {
    description: "Strings where abs(#a - #b) ≤ 1",
    guide:[
      "Track difference of counts limited to ≤1.",
      "Accept if within range."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"},{id:"q3"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q3",symbol:"b"},
      {from:"q2",to:"q1",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q3",to:"q1",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q3; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transitions preventing difference > 1.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } }
    ]
  },
  {
    description: "Strings with number of 'a's double number of 'b's",
    guide:[
      "Accept if #a = 2*#b.",
      "Track with states representing multiples."
    ],
    states:[
      {id:"q0"},{id:"q1"},{id:"q2"},{id:"q3"},{id:"q4",accept:true}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q2",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q3",symbol:"b"},
      {from:"q2",to:"q3",symbol:"a"},
      {from:"q2",to:"q4",symbol:"b"},
      {from:"q3",to:"q4",symbol:"a"},
      {from:"q3",to:"q0",symbol:"b"},
      {from:"q4",to:"q0",symbol:"a"},
      {from:"q4",to:"q1",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q4.", highlight: { activeState: "q0" } },
      { text: "Add transitions for counting multiples.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Mark q4 as accepting.", highlight: { activeState: "q4" } }
    ]
  }
],  
 pattern_repetitions: [
  {
    description: "Strings following pattern (ab)^n",
    guide:[
      "Track repetitions of pattern 'ab'.",
      "Accept if exact multiples."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q2",symbol:"b"},
      {from:"q1",to:"q0",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q2; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q1->q0 on 'b'.", highlight: { transitionArrow: { from: "q1", to: "q0", symbol: "b" } } }
    ]
  },
  {
    description: "Strings following pattern (ba)^n",
    guide:[
      "Track repetitions of pattern 'ba'.",
      "Accept if exact multiples."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q0",to:"q2",symbol:"a"},
      {from:"q1",to:"q0",symbol:"a"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q2; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } },
      { text: "Add transition q1->q0 on 'a'.", highlight: { transitionArrow: { from: "q1", to: "q0", symbol: "a" } } }
    ]
  },
  {
    description: "Strings formed by repeats of 'aba'",
    guide:[
      "Track repeats of substring 'aba'.",
      "Accept if whole string is repetitions."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"},{id:"q3"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q2",to:"q3",symbol:"a"},
      {from:"q3",to:"q0",symbol:"a"},
      {from:"q3",to:"q2",symbol:"b"},
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q1",to:"q1",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q3; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transitions to track 'aba' repeat pattern.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transitions q1 to q2 to q3 and back.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } }
    ]
  },
  {
    description: "Strings with pattern 'abab' repeated",
    guide:[
      "Repeats of substring 'abab'.",
      "Accept exact multiples."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"},{id:"q3"},{id:"q4"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q2",to:"q3",symbol:"a"},
      {from:"q3",to:"q4",symbol:"b"},
      {from:"q4",to:"q0",symbol:"a"},
      {from:"q4",to:"q2",symbol:"b"},
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q1",to:"q1",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"},
      {from:"q3",to:"q3",symbol:"a"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q4; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transitions q0->q1->q2->q3->q4 in pattern.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transition q4->q0 on 'a'.", highlight: { transitionArrow: { from: "q4", to: "q0", symbol: "a" } } }
    ]
  },
  {
    description: "Strings of repeated 'a' only",
    guide:[
      "Accept only strings made of 'a' repeated."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q0",to:"q0",symbol:"a"},
      {from:"q1",to:"q1",symbol:"a"},
      {from:"q1",to:"q1",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add start state q0 as accepting.", highlight: { activeState: "q0" } },
      { text: "Add trap state q1.", highlight: { activeState: "q1" } },
      { text: "Add transition q0->q1 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } },
      { text: "Add self-loops for 'a' and 'b' on q1.", highlight: { transitionArrow: { from: "q1", to: "q1", symbol: "a" } } }
    ]
  }
], 
  forbidden_substrings: [
  {
    description: "No substring 'bab'",
    guide:[
      "Track sequences preventing 'bab'.",
      "Reject if encountered."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"},{id:"q3"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q0",to:"q0",symbol:"a"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q1",symbol:"b"},
      {from:"q2",to:"q3",symbol:"b"},
      {from:"q2",to:"q0",symbol:"a"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q3; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } },
      { text: "Add transitions preventing 'bab' sequence.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } },
      { text: "Add trap state q3.", highlight: { activeState: "q3" } }
    ]
  },
  {
    description: "No substring 'aa'",
    guide:[
      "Reject if 'aa' occurs."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q0",symbol:"b"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q2; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transitions to prevent 'aa'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "a" } } }
    ]
  },
  {
    description: "No substring 'bb'",
    guide:[
      "Reject if 'bb' occurs."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q0",to:"q0",symbol:"a"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q1",to:"q0",symbol:"a"},
      {from:"q2",to:"q2",symbol:"a"},
      {from:"q2",to:"q2",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q2; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'b'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } },
      { text: "Add transitions to prevent 'bb'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } }
    ]
  },
  {
    description: "No substring 'aba'",
    guide:[
      "Reject if 'aba' occurs."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"},{id:"q3"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"a"},
      {from:"q0",to:"q0",symbol:"b"},
      {from:"q1",to:"q2",symbol:"b"},
      {from:"q1",to:"q1",symbol:"a"},
      {from:"q2",to:"q3",symbol:"a"},
      {from:"q2",to:"q0",symbol:"b"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q3; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transition q0->q1 on 'a'.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "a" } } },
      { text: "Add transitions to prevent 'aba'.", highlight: { transitionArrow: { from: "q1", to: "q2", symbol: "b" } } }
    ]
  },
  {
    description: "No substring 'bab' and 'aba'",
    guide:[
      "Reject if either substring occurs."
    ],
    states:[
      {id:"q0",accept:true},{id:"q1"},{id:"q2"},{id:"q3"},{id:"q4"}
    ],
    initial:"q0",
    alpha:["a","b"],
    transitions:[
      {from:"q0",to:"q1",symbol:"b"},
      {from:"q0",to:"q4",symbol:"a"},
      {from:"q1",to:"q2",symbol:"a"},
      {from:"q1",to:"q1",symbol:"b"},
      {from:"q2",to:"q3",symbol:"b"},
      {from:"q2",to:"q4",symbol:"a"},
      {from:"q3",to:"q3",symbol:"a"},
      {from:"q3",to:"q3",symbol:"b"},
      {from:"q4",to:"q4",symbol:"a"},
      {from:"q4",to:"q4",symbol:"b"}
    ],
    constructionSteps:[
      { text: "Add states q0 to q4; q0 accepting.", highlight: { activeState: "q0" } },
      { text: "Add transitions for 'bab' and 'aba' prevention.", highlight: { transitionArrow: { from: "q0", to: "q1", symbol: "b" } } },
      { text: "Add trap states and loops as needed.", highlight: { activeState: "q3" } }
    ]
  }
]
};
const dfaType = document.getElementById('dfaType');
dfaType.innerHTML = '<option value="">Select a type</option>' +
  Object.keys(DFAPRESETS).map(key => {
    // Use first variant's description if available, otherwise the key
    const firstDesc = DFAPRESETS[key][0]?.description || key;
    return `<option value="${key}">${firstDesc}</option>`;
  }).join('');
const POSITIONS = [
  // up to 9 states, visually spaced
  [{x:150,y:160}], //1
  [{x:110,y:160},{x:290,y:160}], //2
  [{x:80, y:160},{x:210, y:75},{x:340,y:160}], //3
  [{x:70, y:120},{x:70, y:220},{x:330, y:120},{x:330, y:220}], //4
  [{x:80, y:80},{x:80, y:240},{x:320, y:80},{x:320, y:240},{x:200,y:160}], //5
  [{x:60, y:60},{x:60, y:260},{x:200, y:60},{x:200,y:260},{x:340, y:60},{x:340,y:260}], //6
  [{x:60, y:80},{x:60, y:240},{x:200, y:80},{x:200, y:240},{x:340, y:80},{x:340, y:240},{x:200,y:160}], //7
  [{x:50,y:60},{x:50,y:260},{x:170,y:60},{x:170,y:260},{x:290, y:60},{x:290,y:260},{x:410,y:60},{x:410,y:260}], //8
  [{x:45,y:45},{x:45,y:275},{x:158,y:45},{x:158, y:275},{x:271,y:45},{x:271, y:275},{x:384, y:45},{x:384, y:275},{x:215,y:160}] //9
];

// --- Drawing ---
const svg = document.getElementById('dfaSVG');

function clearSVG() {
  svg.innerHTML = '';
}
function drawDFA(dfa, highlight = {}, constructionStepIndex = -1) {
  clearSVG();

  const svg = document.getElementById("dfaSVG");

  // Marker
  const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
  const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
  marker.setAttribute("id", "arr");
  marker.setAttribute("markerWidth", "10");
  marker.setAttribute("markerHeight", "10");
  marker.setAttribute("refX", "10");
  marker.setAttribute("refY", "3.5");
  marker.setAttribute("orient", "auto");
  const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
  path.setAttribute("d", "M0,0 L10,3.5 L0,7 Z");
  path.setAttribute("fill", "#4a90e2");
  marker.appendChild(path);
  defs.appendChild(marker);

  // Remove old defs if any, then add new
  const oldDefs = svg.querySelector("defs");
  if (oldDefs) svg.removeChild(oldDefs);
  svg.appendChild(defs);

  // Layout states nicely
  const n = dfa.states.length;
  const poslist = POSITIONS[n] || POSITIONS[POSITIONS.length - 1];
  const statePos = {};
  dfa.states.forEach((s, i) => {
    let { x, y } = poslist[i];
    x += 220;
    y += 0; // shift visually
    statePos[s.id] = { x, y };
  });

  // Decide what to draw depending on constructionStepIndex
  // If constructionStepIndex < 0, draw all states and transitions
  // Else, draw only states/transitions relevant up to that step

  // For this example, fully draw (can be enhanced by mapping constructionStepIndex to states/transitions)
  // Draw transitions (arrows)
  for (const t of dfa.transitions) {
    let { from, to, symbol } = t;
    const highlightArrow =
      highlight.transitionArrow &&
      highlight.transitionArrow.from === from &&
      highlight.transitionArrow.to === to &&
      highlight.transitionArrow.symbol === symbol;
    if (from !== to) {
      drawArrow(statePos[from], statePos[to], symbol, highlightArrow);
    } else {
      drawSelfLoop(statePos[from], symbol, highlightArrow);
    }
  }

  // Draw states
  dfa.states.forEach((s) => {
    const { x, y } = statePos[s.id];
    drawState(
      x,
      y,
      s.id,
      dfa.initial === s.id,
      !!s.accept,
      highlight.activeState === s.id
    );
  });

  // Draw state labels again for clarity
  dfa.states.forEach((s) => {
    const { x, y } = statePos[s.id];
    drawStateLabel(x, y, s.id);
  });

  // Return position mapping for use in animation
  return statePos;
}
function drawArrow(from, to, label, highlight) {
  const dx = to.x - from.x, dy = to.y - from.y;
  const len = Math.sqrt(dx*dx + dy*dy);
  const nx = dx/len, ny = dy/len;
  const startX = from.x + nx*30, startY = from.y + ny*30;
  const endX = to.x - nx*30, endY = to.y - ny*30;

  const curve = 0.14*len;
  const c1x = startX + curve*ny, c1y = startY - curve*nx;
  const c2x = endX + curve*ny, c2y = endY - curve*nx;

  const path = document.createElementNS('http://www.w3.org/2000/svg','path');
  path.setAttribute('d',`M${startX},${startY} C${c1x},${c1y} ${c2x},${c2y} ${endX},${endY}`);
  path.setAttribute('class','arrow'+(highlight?' active':''));
  path.setAttribute('marker-end','url(#arr)');
  svg.appendChild(path);

  // Label
  const lm = 0.5;
  const labelX = startX*lm + endX*(1-lm) + curve*ny;
  const labelY = startY*lm + endY*(1-lm) - curve*nx - 8;
  const text = document.createElementNS('http://www.w3.org/2000/svg','text');
  text.textContent = label;
  text.setAttribute('class','transLabel');
  text.setAttribute('x',labelX);
  text.setAttribute('y',labelY);
  svg.appendChild(text);
}
function drawSelfLoop(pos, label, highlight) {
  const {x,y} = pos;
  const r = 30;
  const path = document.createElementNS('http://www.w3.org/2000/svg','path');
  path.setAttribute('d',
    `M${x},${y-r} C${x+36},${y-48},${x-36},${y-48},${x},${y-r}`);
  path.setAttribute('class','selfloop'+(highlight?' active':''));
  svg.appendChild(path);

  // Label
  const text = document.createElementNS('http://www.w3.org/2000/svg','text');
  text.textContent = label;
  text.setAttribute('class','selfloopLabel');
  text.setAttribute('x',x);
  text.setAttribute('y',y-r-27);
  text.setAttribute('text-anchor','middle');
  svg.appendChild(text);
}
function drawState(x,y,id,initial,final,active) {
  const g = document.createElementNS('http://www.w3.org/2000/svg','g');
  if (active) g.style.filter="drop-shadow(0 0 10px #ffd54f)";
  svg.appendChild(g);

  const cir = document.createElementNS('http://www.w3.org/2000/svg','circle');
  cir.setAttribute('cx',x);
  cir.setAttribute('cy',y);
  cir.setAttribute('r',30);
  cir.setAttribute('stroke','#4a90e2');
  cir.setAttribute('stroke-width',final?"4":"2.2");
  cir.setAttribute('fill',active?'#ffd54f':(final?'#eafcf6':'#f5f8fd'));
  g.appendChild(cir);
  if (final) {
    const fc = document.createElementNS('http://www.w3.org/2000/svg','circle');
    fc.setAttribute('cx',x); fc.setAttribute('cy',y);
    fc.setAttribute('r',24);
    fc.setAttribute('stroke','#2ecc71');
    fc.setAttribute('stroke-width',"2.2");
    fc.setAttribute('fill','none');
    g.appendChild(fc);
  }
  if (initial) {
    const arr = document.createElementNS('http://www.w3.org/2000/svg','path');
    arr.setAttribute('d',`M${x-65},${y} L${x-38},${y}`);
    arr.setAttribute('stroke','#e67e22');
    arr.setAttribute('stroke-width',"3");
    arr.setAttribute('marker-end','url(#arr)');
    svg.appendChild(arr);
  }
}
function drawStateLabel(x,y,label) {
  const text = document.createElementNS('http://www.w3.org/2000/svg','text');
  text.textContent = label;
  text.setAttribute('class','stateLabel');
  text.setAttribute('x',x);
  text.setAttribute('y',y+7);
  text.setAttribute('text-anchor','middle');
  svg.appendChild(text);
}

// --- Animation logic ---
let CURRENT_DFA = null, STATE_POS = null, ANIMATION = null;

function loadDFA(type, idx = 0) {
  const preset = DFAPRESETS[type][idx];
  CURRENT_DFA = preset;
  guide.innerHTML = `<b>${preset.description}</b><br>${preset.guide.map(x => '<div>' + x + '</div>').join('')}`;
  STATE_POS = drawDFA(preset, {});
  output.textContent = '';
}

const problemDragPanel = document.getElementById('problemDragPanel');
const problemDropZone = document.getElementById('problemDropZone');
const dropText = document.getElementById('dropText');

// Update drag panel when DFA type changes
dfaType.onchange = function() {
  clearSVG();
  output.textContent = '';
  if (!dfaType.value) {
    guide.innerHTML = 'Select a DFA type to see construction steps and run animation.';
    problemDragPanel.innerHTML = '';
    dropText.textContent = 'Drop problem here';
    return;
  }
  const problems = DFAPRESETS[dfaType.value] || [];
  problemDragPanel.innerHTML = '';
  problems.forEach((prob, i) => {
    let node = document.createElement('div');
    node.textContent = prob.description || `Variant ${i+1}`;
    node.setAttribute('draggable', true);
    node.style.cssText = 'user-select:none;padding:7px 18px;background:#eef;border-radius:7px;box-shadow:0 2px 4px #0001;cursor:grab;';
    node.dataset.type = dfaType.value;
    node.dataset.idx = i;
    node.ondragstart = e => { 
      e.dataTransfer.setData('type', dfaType.value); 
      e.dataTransfer.setData('idx', i); 
    };
    problemDragPanel.appendChild(node);
  });
  dropText.textContent = 'Drop problem here';
};

// Drop events
problemDropZone.ondragover = e => { e.preventDefault(); problemDropZone.style.background = '#e0f7fa'; };
problemDropZone.ondragleave = () => { problemDropZone.style.background = ''; };
problemDropZone.ondrop = e => {
  e.preventDefault();
  let type = e.dataTransfer.getData('type');
  let idx = +e.dataTransfer.getData('idx');
  if (type && DFAPRESETS[type] && DFAPRESETS[type][idx]) {
    loadDFA(type, idx);
    dropText.textContent = `Selected: ${DFAPRESETS[type][idx].description || type}`;
    problemDropZone.style.background = '';
  }
};
function* animateTraverse(dfa, input) {
  let curr = dfa.initial;
  yield {activeState:curr};
  for (let i=0; i<input.length; ++i) {
    const c = input[i];
    let t = dfa.transitions.find(t=>t.from===curr&&t.symbol===c);
    if (!t) {
      yield {activeState:curr, error:`No transition from ${curr} on '${c}'.`};
      return;
    }
    yield {activeState:curr, transitionArrow:t};
    curr = t.to;
    yield {activeState:curr};
  }
  if (dfa.states.find(s=>s.id===curr&&s.accept)) {
    yield {activeState:curr, accept:true};
  } else {
    yield {activeState:curr, reject:true};
  }
}
testBtn.onclick = ()=>{
  if (!CURRENT_DFA) return;
  const input = testStr.value.trim();
  for (let ch of input) if (!CURRENT_DFA.alpha.includes(ch)) {
    output.textContent=`Error: symbol '${ch}' not in {a,b}`;
    return;
  }
  // reset and draw
  ANIMATION=animateTraverse(CURRENT_DFA, input);
  nextAnimStep();
};
function nextAnimStep() {
  if (!ANIMATION) return;
  const {value,done}=ANIMATION.next();
  if (!value) return;
  drawDFA(CURRENT_DFA,value);
  if (value.error) {
    output.textContent=value.error;
    ANIMATION=null; return;
  }
  if (value.accept) { output.textContent="String accepted (in final state)!"; ANIMATION=null; return;}
  if (value.reject) { output.textContent="String rejected (nonfinal state)."; ANIMATION=null; return;}
  if (!ANIMATION || done) return;
  setTimeout(nextAnimStep, 850);
}
resetBtn.onclick = ()=>{
  if (!CURRENT_DFA) return;
  drawDFA(CURRENT_DFA,{});
  output.textContent='';
  ANIMATION=null;
};
// Construction animation control variables
let constructionStepIndex = -1;
let constructionAutoPlay = true;
let constructionAutoTimeout = null;
let currentConstructionSteps = null;
let currentConstructionHighlight = {};

// Update guide and highlight visualization for current construction step
function updateConstructionGuide() {
  if (!currentConstructionSteps || constructionStepIndex < 0 || constructionStepIndex >= currentConstructionSteps.length) {
    guide.textContent = "DFA construction complete.";
    drawDFA(CURRENTDFA, {});
    return;
  }
  guide.textContent = currentConstructionSteps[constructionStepIndex].text;
  currentConstructionHighlight = currentConstructionSteps[constructionStepIndex].highlight || {};
  drawDFA(CURRENTDFA, currentConstructionHighlight);
}

// Go forward one construction step
function nextConstructionStep() {
  if (!currentConstructionSteps) return;
  if (constructionStepIndex < currentConstructionSteps.length - 1) {
    constructionStepIndex++;
    updateConstructionGuide();
    if (constructionAutoPlay) {
      constructionAutoTimeout = setTimeout(nextConstructionStep, 1200);
    }
  } else {
    clearTimeout(constructionAutoTimeout);
  }
}

// Go backward one construction step
function prevConstructionStep() {
  if (!currentConstructionSteps) return;
  if (constructionStepIndex > 0) {
    constructionStepIndex--;
    updateConstructionGuide();
    clearTimeout(constructionAutoTimeout);
  }
}

// Setup event handlers for construction animation buttons and toggle
document.getElementById("nextDesignStepBtn").addEventListener("click", () => {
  constructionAutoPlay = false;
  document.getElementById("autoDesignPlayToggle").checked = false;
  nextConstructionStep();
});

document.getElementById("prevDesignStepBtn").addEventListener("click", () => {
  constructionAutoPlay = false;
  document.getElementById("autoDesignPlayToggle").checked = false;
  prevConstructionStep();
});

document.getElementById("autoDesignPlayToggle").addEventListener("change", (e) => {
  constructionAutoPlay = e.target.checked;
  if (constructionAutoPlay) nextConstructionStep();
  else clearTimeout(constructionAutoTimeout);
});

// Reset and initialize construction when problem changes
dfaProblem.addEventListener("change", () => {
  clearTimeout(constructionAutoTimeout);
  constructionStepIndex = -1;
  if (dfaProblem.value !== "" && dfaType.value !== "" && CURRENTDFA && CURRENTDFA.constructionSteps) {
    currentConstructionSteps = CURRENTDFA.constructionSteps;
    document.getElementById("prevDesignStepBtn").disabled = false;
    document.getElementById("nextDesignStepBtn").disabled = false;
    document.getElementById("autoDesignPlayToggle").disabled = false;
    constructionAutoPlay = true;
    document.getElementById("autoDesignPlayToggle").checked = true;
    nextConstructionStep();
  } else {
    currentConstructionSteps = null;
    document.getElementById("prevDesignStepBtn").disabled = true;
    document.getElementById("nextDesignStepBtn").disabled = true;
    document.getElementById("autoDesignPlayToggle").disabled = true;
    guide.textContent = "Select a problem to see construction steps and run animation.";
    drawDFA(CURRENTDFA || {});
  }
});
// Load first DFA for instant preview
dfaType.value = '';
clearSVG();
</script>
</body>
</html>
